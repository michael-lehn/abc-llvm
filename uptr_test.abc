@ <stdio.hdr>

fn last(this: ->-> char)
{
    if (*this) {
	printf(" last: *this = %s\n", *this);
    }
}

fn foo(msg: => char + last): => char + last
{
    printf("foo called: msg = %s\n", msg);
    return msg;
}

fn bar(): => char + last
{
    return "The World Ends!";
}

fn main(): int
{
    local msg: => char + last = "hello, world";
    local msg2: => char + last = "Hallo Welt!";

    printf("msg = %s\n", msg);
    printf("msg2 = %s\n",  msg2);

    msg2 = foo(~msg);

    printf("msg = %s\n",  msg);
    printf("msg2 = %s\n",  msg2);

    msg = ~msg2;

    printf("msg = %s\n",  msg);
    printf("msg2 = %s\n",  msg2);

    msg = bar();

    printf("msg = %s\n",  msg);
    printf("msg2 = %s\n",  msg2);

    msg2 = ~msg;

    printf("msg = %s\n",  msg);
    printf("msg2 = %s\n",  msg2);

}
